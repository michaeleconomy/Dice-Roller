import SceneKit

class DiceFace {
    static let facesForDice: [String: [(SCNVector3, String)]] = [
        "d4": [
            (SCNVector3(x: 1.580217, y: 1.02750969, z: 0.00207090657), "1"),
            (SCNVector3(x: -1.56563127, y: 0.851895273, z: 3.14015222), "1"),
            (SCNVector3(x: -2.6259737, y: 0.593505204, z: -1.82351065), "2"),
            (SCNVector3(x: 1.00329483, y: -0.638103724, z: -1.60479867), "2"),
            (SCNVector3(x: -2.78984284, y: 0.723822653, z: -0.00902289897), "3"),
            (SCNVector3(x: -0.528968453, y: 0.0707818344, z: 0.93439883), "4"),
            (SCNVector3(x: 1.53753722, y: 0.551641822, z: 1.90975726), "4")
        ],
        "d6": [
            (SCNVector3(x: 0.00191434007, y: -0.617456317, z: -0.0107159335), "1"),
            (SCNVector3(x: 1.58350158, y: -1.0714767, z: -0.0064351717), "2"),
            (SCNVector3(x: -1.56331146, y: -1.20240569, z: -3.13888669), "2"),
            (SCNVector3(x: 1.55949485, y: 0.990554512, z: -0.0153725296), "2"),
            (SCNVector3(x: 1.58242309, y: -0.153930575, z: -4.74324333e-05), "2"),
            (SCNVector3(x: 1.58116364, y: -0.487173438, z: -0.000442738325), "2"),
            (SCNVector3(x: 0, y: 0, z: 0), "3"),
            (SCNVector3(x: 1.73473096, y: 0.000549226999, z: -1.56692612), "4"),
            (SCNVector3(x: 0.360743314, y: 0.0129732555, z: -1.55124259), "4"),
            (SCNVector3(x: -3.08033967, y: -0.00391858304, z: -1.57163811), "4"),
            (SCNVector3(x: -1.54870725, y: 1.48108256, z: 0.0117181838), "5"),
            (SCNVector3(x: 1.58803821, y: 1.0888772, z: -3.12152028), "5"),
            (SCNVector3(x: 1.56517744, y: -0.497851551, z: -3.13040519), "5"),
            (SCNVector3(x: -0.0301063191, y: 1.40787375, z: 3.12377167), "6"),
            (SCNVector3(x: -3.14008141, y: 1.38185775, z: 0.0142904939), "6"),
            (SCNVector3(x: 3.15128255, y: -1.57079637, z: 0.0), "6"),
            (SCNVector3(x: -0.0232654382, y: -1.06078231, z: -3.11260772), "6")
        ],
        "d8": [
            (SCNVector3(x: -0.533942759, y: -0.945355833, z: 1.36608803), "1"),
            (SCNVector3(x: -1.11551881, y: 0.933632493, z: 1.29986489), "2"),
            (SCNVector3(x: 1.83915436, y: -0.895044863, z: 1.98998642), "2"),
            (SCNVector3(x: 2.28061366, y: 0.106581986, z: -0.613092363), "3"),
            (SCNVector3(x: 1.76562524, y: 0.0982948691, z: -2.35705829), "4"),
            (SCNVector3(x: -0.233719915, y: -0.642201304, z: -0.800150037), "4"),
            (SCNVector3(x: -1.03143775, y: 0.335547745, z: -0.653155386), "4"),
            (SCNVector3(x: 2.93688488, y: 0.761946738, z: 0.760921061), "5"),
            (SCNVector3(x: -1.95230293, y: -0.508413494, z: -0.718162775), "6"),
            (SCNVector3(x: 2.39590716, y: 0.83691138, z: -1.75499558), "6"),
            (SCNVector3(x: -2.82222295, y: 0.572037697, z: -0.75070101), "6"),
            (SCNVector3(x: 0.879332542, y: 0.958164752, z: 1.64968765), "7"),
            (SCNVector3(x: -1.58357751, y: 0.784347832, z: -2.20067954), "8"),
            (SCNVector3(x: 0.479850709, y: 0.411588579, z: -0.673713684), "8"),
        ],
        "d10": [
            (SCNVector3(x: -0.6864869, y: 0.35619843, z: 0.358194709), "1"),
            (SCNVector3(x: 2.53530192, y: -0.545982957, z: 2.74826074), "1"),
            (SCNVector3(x: -2.67628932, y: 1.02711427, z: 1.2995398), "2"),
            (SCNVector3(x: -0.334321201, y: -0.656171203, z: 2.46238589), "2"),
            (SCNVector3(x: 2.17412663, y: -0.296346337, z: 0.546283722), "2"),
            (SCNVector3(x: 0.380791247, y: -1.01559949, z: 1.91413784), "2"),
            (SCNVector3(x: 2.63895416, y: 0.755895317, z: -1.63940859), "3"),
            (SCNVector3(x: 1.8167249, y: 0.521738648, z: -2.15035939), "3"),
            (SCNVector3(x: -2.35265636, y: 0.123455517, z: -2.95397615), "4"),
            (SCNVector3(x: 0.890653253, y: -0.578481674, z: -0.224416792), "4"),
            (SCNVector3(x: -2.49305248, y: -0.354547858, z: 0.13556686), "5"),
            (SCNVector3(x: -2.92739391, y: 0.675163388, z: 2.04618335), "6"),
            (SCNVector3(x: 0.180256218, y: -0.689706862, z: 1.11624014), "6"),
            (SCNVector3(x: 0.459103495, y: -0.554187119, z: 0.95270896), "6"),
            (SCNVector3(x: -1.10906422, y: 0.373561263, z: -0.521226823), "7"),
            (SCNVector3(x: 0.409974188, y: 1.18994951, z: -1.94658589), "8"),
            (SCNVector3(x: 2.29230952, y: 0.243016645, z: -0.365139365), "8"),
            (SCNVector3(x: 0.191956401, y: 1.14428163, z: -2.14777637), "8"),
            (SCNVector3(x: 1.75345743, y: -0.422710896, z: 2.16899467), "9"),
            (SCNVector3(x: -2.4629724, y: -0.418936491, z: 0.970131874), "9"),
            (SCNVector3(x: -0.267652899, y: 0.713302672, z: 1.62994468), "9"),
            (SCNVector3(x: 0.910683811, y: 0.313382894, z: -0.745628059), "10"),
            (SCNVector3(x: -0.0188108403, y: 0.746752501, z: -1.42702162), "10"),
            (SCNVector3(x: -0.829704165, y: 0.661722302, z: -1.96983671), "10"),
            (SCNVector3(x: -0.834655344, y: 0.0505598113, z: -1.60144269), "10")
        ],
        "d12": [
            (SCNVector3(x: 1.1187923, y: -0.772773266, z: -2.98914862), "1"),
            (SCNVector3(x: -1.82473302, y: -1.03898239, z: 0.497093111), "1"),
            (SCNVector3(x: 1.73570812, y: -0.21350652, z: 2.96380305), "1"),
            (SCNVector3(x: 0.171625584, y: 1.39881837, z: 1.61474442), "1"),
            (SCNVector3(x: -1.55971873, y: 0.225113645, z: -0.00363124302), "1"),
            (SCNVector3(x: 1.26801205, y: 0.736541629, z: -1.25830281), "2"),
            (SCNVector3(x: -2.77769136, y: -0.733739078, z: -1.25459588), "2"),
            (SCNVector3(x: 0.69606632, y: 0.549252987, z: -2.82415652), "3"),
            (SCNVector3(x: 0.565355837, y: 0.927692831, z: 3.0909996), "3"),
            (SCNVector3(x: -2.42684555, y: -0.596159637, z: -0.328751206), "3"),
            (SCNVector3(x: 2.33368826, y: -0.788073599, z: 0.393950671), "4"),
            (SCNVector3(x: -1.71291888, y: 0.0825573951, z: -1.07262671), "5"),
            (SCNVector3(x: 1.63930714, y: 0.0413636491, z: -2.07255769), "5"),
            (SCNVector3(x: -2.04736376, y: 0.325279951, z: -2.30198622), "6"),
            (SCNVector3(x: -1.72150421, y: 0.555158257, z: 0.981224835), "7"),
            (SCNVector3(x: 1.59799016, y: -0.64466387, z: 2.05895209), "7"),
            (SCNVector3(x: -0.320308775, y: -0.483280391, z: 1.72750628), "8"),
            (SCNVector3(x: 2.48179507, y: -0.449589044, z: -2.84153295), "9"),
            (SCNVector3(x: 0.00239691185, y: -1.06655848, z: -0.587372243), "9"),
            (SCNVector3(x: -0.792429268, y: 0.760773182, z: -0.377661645), "9"),
            (SCNVector3(x: 1.24635923, y: -1.29549849, z: -1.76548719), "9"),
            (SCNVector3(x: -2.980582, y: 0.892684758, z: 2.69271135), "10"),
            (SCNVector3(x: 0.303159565, y: -0.656757116, z: 0.348668277), "10"),
            (SCNVector3(x: -2.42250991, y: -0.786046803, z: 1.64164591), "11"),
            (SCNVector3(x: 1.32640862, y: 0.720256984, z: 1.92154849), "11"),
            (SCNVector3(x: -0.272540838, y: 0.71019119, z: -1.19363844), "12"),
            (SCNVector3(x: -1.58731949, y: 0.895962954, z: 3.13489008), "12")
        ],
        "d20": [
            (SCNVector3(x: 1.43971622, y: -1.4916538, z: 0.0930736437), "1"),
            (SCNVector3(x: 1.53386569, y: 0.169859469, z: 0.00806442462), "1"),
            (SCNVector3(x: -2.22417736, y: -0.593713582, z: -0.197146818), "2"),
            (SCNVector3(x: 0.878443599, y: 0.427088737, z: -2.96355081), "2"),
            (SCNVector3(x: 1.92983711, y: 1.39245379, z: -2.01061273), "2"),
            (SCNVector3(x: -2.4061718, y: -0.229293391, z: 2.23710084), "3"),
            (SCNVector3(x: 0.832532525, y: 0.298178047, z: 0.929840207), "3"),
            (SCNVector3(x: 3.10880494, y: 0.289141178, z: -1.60928226), "4"),
            (SCNVector3(x: -1.27157462, y: -0.900980413, z: 0.556329548), "4"),
            (SCNVector3(x: 1.99390137, y: 0.0953007862, z: -1.84598935), "4"),
            (SCNVector3(x: 0.188730478, y: -0.288216978, z: -1.59561443), "4"),
            (SCNVector3(x: -2.95311522, y: -0.812641382, z: -0.728982568), "5"),
            (SCNVector3(x: 3.04677606, y: -0.386230946, z: -0.693236828), "5"),
            (SCNVector3(x: 0.81832397, y: 0.907231331, z: -1.85392261), "5"),
            (SCNVector3(x: -0.441414624, y: 0.313022286, z: -0.204580367), "6"),
            (SCNVector3(x: -0.00765432883, y: -1.06940651, z: -0.417054534), "6"),
            (SCNVector3(x: 2.73987556, y: -0.109667502, z: -2.94538522), "6"),
            (SCNVector3(x: 2.10944891, y: -1.25492382, z: -2.46387005), "6"),
            (SCNVector3(x: 0.0449506342, y: -0.988142908, z: 2.00035048), "7"),
            (SCNVector3(x: 0.945855856, y: -1.0108813, z: 1.22814023), "7"),
            (SCNVector3(x: -2.15332031, y: 0.999766231, z: 1.94926763), "7"),
            (SCNVector3(x: 1.40874505, y: 0.485028476, z: 2.40654492), "8"),
            (SCNVector3(x: 0.510946333, y: -0.411122769, z: -0.428198695), "9"),
            (SCNVector3(x: 0.197350174, y: -0.0362669751, z: -0.36405921), "9"),
            (SCNVector3(x: 0.211160094, y: 0.282408148, z: -0.406604648), "9"),
            (SCNVector3(x: 1.54406786, y: -0.290660322, z: 1.90808392), "10"),
            (SCNVector3(x: 0.967114866, y: 0.00615952443, z: -1.1240685), "11"),
            (SCNVector3(x: 2.72490859, y: -0.439461827, z: -1.64689755), "11"),
            (SCNVector3(x: 0.173149064, y: 0.358145058, z: 2.35603881), "12"),
            (SCNVector3(x: -0.989954531, y: 0.298983037, z: -2.26931167), "13"),
            (SCNVector3(x: 1.26532829, y: 0.454385966, z: -0.951481044), "13"),
            (SCNVector3(x: 2.99354506, y: 0.953113616, z: -2.1793139), "14"),
            (SCNVector3(x: -1.01475871, y: 0.00914766733, z: -0.496291578), "14"),
            (SCNVector3(x: -0.329251945, y: -0.861029625, z: -0.819927335), "14"),
            (SCNVector3(x: 2.32065082, y: 0.335935473, z: -2.6135602), "14"),
            (SCNVector3(x: 1.20974481, y: -1.48622727, z: 1.56872368), "15"),
            (SCNVector3(x: -0.368149817, y: 0.0804628804, z: 3.08575439), "15"),
            (SCNVector3(x: 2.39074206, y: 1.11665428, z: -0.41767031), "15"),
            (SCNVector3(x: 0, y: 0, z: 0), "16"),
            (SCNVector3(x: -1.64156473, y: 0.101925135, z: 1.90500283), "17"),
            (SCNVector3(x: 0.406034976, y: -0.344667733, z: 1.5053302), "17"),
            (SCNVector3(x: 0.431956828, y: 0.0149699058, z: -2.31459475), "18"),
            (SCNVector3(x: 1.10731542, y: 1.11664295, z: 0.36964044), "19"),
            (SCNVector3(x: -2.0759871, y: -1.07128477, z: 2.80901814), "19"),
            (SCNVector3(x: 0.514817059, y: -1.01457119, z: 0.30076319), "19"),
            (SCNVector3(x: -1.64933896, y: -1.49036527, z: 0.0802871063), "20"),
            (SCNVector3(x: 1.56664169, y: 0.632603407, z: 3.13267183), "20")
        ]
    ];
    
    static func getFaceForRoll(die: SCNNode) -> String {
        guard let facesForDie = facesForDice[die.name!] else {
            return "unknown die \(die.name ?? "unknown name")"
        }
        var distanceToClosest: Float = 99999.0
        let currentAngle = die.presentation.eulerAngles
        var closest = "no angle founds"
        facesForDie.forEach({ angle, side in
            let distance = acos(dot(normalize(float3(currentAngle)), normalize(float3(angle))))
            
//            let distance = abs(currentAngle.x - angle.x) + abs(currentAngle.z - angle.z) + abs(currentAngle.z - angle.z)
            if (distance < distanceToClosest) {
                distanceToClosest  = distance
                closest = side
            }
        })
        return closest
    }
}
